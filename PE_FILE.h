#pragma once
#include <windows.h>


#pragma comment(lib, "ntdll.lib")

class PE_FILE
{
public:
	PE_FILE(PBYTE peBuffer, SIZE_T peSize);

	~PE_FILE();

	bool isParse();

	ULONG imageSize();
	ULONG addressOfEntryPoint();
	USHORT numberOfSection(); //섹션개수
	ULONG_PTR Get_FirstSection();
	ULONG_PTR Get_NextSection(ULONG_PTR currentSection); //다음섹션
	LONG_PTR Get_Relative_Offset(ULONG_PTR imagebase);//기준주소로부터 얼만큼 떨어지는지 
	void Set_Imagebase(LONG_PTR imagebase); // 이미지 베이스 재설정

	ULONG_PTR memAlloc(SIZE_T size);// 메모리 할당
	PVOID getAddress(HMODULE Module, char* FunctionName); // 함수 주소 가져오기
	bool resolveIAT(ULONG_PTR imageBase);// 임포트한 dll을 가져와 재배치해서 리졸빙 해주는
	void relocate(ULONG_PTR TempAddr, ULONG_PTR imageBase);// 재배치를 통해서 실제 코드의 주소를 기준주소로부터 얼마나 떨어져있는지 재배치
	void memFree(ULONG_PTR TempAddr);

	PBYTE peHeader();
	ULONG peHeaderSize();

private:
	PBYTE _peBuffer;
	PIMAGE_DOS_HEADER DosHeader;
	PIMAGE_NT_HEADERS NTHeader;
};