# Malware_project

악성코드 제작 프로젝트
-----------------------
공부용으로 제작된 악성코드로 위험한 악성행위보다 악성코드에서 사용되는 기술에 집중되어 작성 됨.

드롭퍼 기능으로 TEMP 폴더에 실행파일 생성 후 원본파일은 삭제함. 

레지스트리 "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" 내 TEMP 실행 파일을 등록하여 자동 실행. 

"Process Hollowing" 과 Reflective DLL injection의 기반이 되는 "DLL Manual Mapping" 기술을 이용하여 악성 파일을 메모리에 로드. 

피해자의 간단한 정보를 수집하여 TEMP 폴더에 저장. 

TEMP 폴더에 생성된 피해자 정보 파일을 공격자 서버에 전송. 

탐지를 피하기 위하여 system call 함수를 수동으로 구현하여 호출함. 



 
injected_file/Hollowing_PEfile.cpp 
= 프로세스 할로잉 시 로드되는 PE 파일, 피해자 정보를 수집하여 TEMP 폴더 내 저장. 등등

injected_file/manual_mapping_dll.cpp
= dll 매뉴얼 매핑 시 로드되는 dll 파일, TEMP 내 피해자 정보 파일을 공격자에게 전송. 등등

Main_File/File_Injector.cpp 
= 인젝션 시 사용되는 함수 모음. 
헤더, 섹션에 쓸 데이터를 메모리에 쓰기.  
작성된 메모리를 타겟(타겟 프로세스 or 자신) 메모리에 작성. 
작성된 주소를 기반으로 쓰레드 실행.  
등등

Main_File/PE_FILE.cpp
= pe 파일의 구조에 접근 및 수정하기 위한 함수 모음.  
엔트리 포인트, 섹션 수, 첫 섹션 및 다음 섹션 획득.  
이미지 베이스 설정.  
GetProcAddress 수동 구현.  
IAT 테이블 리졸빙.  
메모리에 정상 로드 하기위한 재배치(RELOACTE). 
등등

Main_File/directsyscall.asm
= system call 수동 호출을 위하여 어셈블리어로 작성.  
시스템 함수 번호를 이용하여 호출.  

Main_File/dropper.cpp
=TEMP 폴더 경로 획득. 
TEMP 폴더 내 현재 프로세스 복사본 저장. 
TEMP 폴더에 저장된 프로세스 "-copy" 인자를 넣어 재 실행 (삭제 구분 용). 
기존 파일 삭제. 
등등

Main_File/main.cpp
= 각 함수를 호출하여 동작 수행.

Main_File/phnt.h
= 동작에 필요한 window 구조체 정보, 변수, 인자 값 정의.

Main_File/process_.cpp
= 프로세스 실행 및 핸들 획득. 
ThreadContext 획득. 
Process Hollowing 으로 인한 suspended 된 프로세스 실행. 
Unmapping 으로 공간확보. 



참고 코드 및 "phnt.h"의 코드 출처 : Github의 phnt 코드 (https://github.com/winsiderss/phnt/tree/master), https://esa.eduwill.net/Guide/MaterialDetail?div=S&idx=21393
