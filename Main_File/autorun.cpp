#include "autorun.h"
#include <tchar.h>
#include <iostream>

bool AddToStartup() {
    HKEY hKey;
    LPCWSTR runKey = L"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run";
    LPCWSTR appName = L"test_svchost.exe";
    WCHAR filePath[MAX_PATH];

    if (GetModuleFileNameW(NULL, filePath, MAX_PATH) == 0) {
        return false;
    }

    if (RegOpenKeyExW(HKEY_CURRENT_USER, runKey, 0, KEY_WRITE, &hKey) != ERROR_SUCCESS) {
        return false;
    }

    if (RegSetValueExW(hKey, appName, 0, REG_SZ, (const BYTE*)filePath, (wcslen(filePath) + 1) * sizeof(WCHAR)) != ERROR_SUCCESS) {
        RegCloseKey(hKey);
        return false;
    }

    RegCloseKey(hKey);
    return true;
}
